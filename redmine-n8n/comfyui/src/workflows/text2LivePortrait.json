{
  "last_node_id": 120,
  "last_link_id": 999,
  "nodes": [
    {
      "id": 1,
      "type": "CheckpointLoaderSimple",
      "pos": [40, 80],
      "size": [300, 70],
      "widgets_values": ["dreamshaper_8.safetensors"],
      "outputs": [
        {"name":"MODEL","type":"MODEL"},
        {"name":"CLIP","type":"CLIP"},
        {"name":"VAE","type":"VAE"}
      ]
    },
    {
      "id": 2,
      "type": "CLIPTextEncode",
      "pos": [40, 170],
      "size": [380, 150],
      "title": "Positive Prompt",
      "widgets_values": ["a cinematic portrait, natural skin tones, soft light, 85mm lens, shallow depth of field, subtle film grain"],
      "inputs": [{"name":"clip","type":"CLIP","link":1}],
      "outputs": [{"name":"CONDITIONING","type":"CONDITIONING"}]
    },
    {
      "id": 3,
      "type": "CLIPTextEncode",
      "pos": [40, 330],
      "size": [380, 150],
      "title": "Negative Prompt",
      "widgets_values": ["nsfw, nudity, explicit, watermark, text, extra fingers, extra limbs, bad anatomy, blurry, lowres, deformed, disfigured, gore"],
      "inputs": [{"name":"clip","type":"CLIP","link":1}],
      "outputs": [{"name":"CONDITIONING","type":"CONDITIONING"}]
    },
    {
      "id": 4,
      "type": "EmptyLatentImage",
      "pos": [40, 500],
      "size": [300, 100],
      "widgets_values": [640, 640, 1],
      "outputs": [{"name":"LATENT","type":"LATENT"}]
    },
    {
      "id": 5,
      "type": "KSampler",
      "pos": [430, 240],
      "size": [330, 200],
      "widgets_values": [123456789, 32, 6.5, "dpmpp_2m", "karras", 1.0],
      "inputs": [
        {"name":"model","type":"MODEL","link":1},
        {"name":"positive","type":"CONDITIONING","link":2},
        {"name":"negative","type":"CONDITIONING","link":3},
        {"name":"latent_image","type":"LATENT","link":4}
      ],
      "outputs": [{"name":"LATENT","type":"LATENT"}]
    },
    {
      "id": 6,
      "type": "VAEDecode",
      "pos": [790, 260],
      "size": [230, 70],
      "inputs": [
        {"name":"samples","type":"LATENT","link":5},
        {"name":"vae","type":"VAE","link":1}
      ],
      "outputs": [{"name":"IMAGE","type":"IMAGE"}]
    },
    {
      "id": 7,
      "type": "YetAnotherSafetyChecker",
      "pos": [1040, 260],
      "size": [260, 70],
      "widgets_values": [0.40, false],
      "inputs": [{"name":"image","type":"IMAGE","link":6}],
      "outputs": [{"name":"IMAGE","type":"IMAGE"}]
    },

    // ---- VibeVoice TTS (spoken_content -> audio) ----
    {
      "id": 20,
      "type": "VibeVoice_TTS",
      "pos": [40, 720],
      "size": [420, 170],
      "title": "VibeVoice TTS",
      "widgets_values": [
        "Hello there, I am alive. This line is driven entirely by text and synthesized to speech for lip sync.",
        "female_alloy",         // voice id: change to your preset
        22050,                 // sample rate
        1.0,                   // speed
        1.0                    // energy
      ],
      "outputs": [{"name":"AUDIO","type":"AUDIO"}]
    },
    {
      "id": 21,
      "type": "AudioResample",
      "pos": [500, 740],
      "size": [220, 70],
      "widgets_values": [22050, 1],
      "inputs": [{"name":"audio","type":"AUDIO","link":20}],
      "outputs": [{"name":"AUDIO","type":"AUDIO"}]
    },

    // ---- Wav2Lip (image + audio -> talking frames) ----
    {
      "id": 30,
      "type": "Wav2Lip",
      "pos": [1040, 610],
      "size": [320, 160],
      "widgets_values": [25, 0.5], // fps, enhancement
      "inputs": [
        {"name":"image","type":"IMAGE","link":7},
        {"name":"audio","type":"AUDIO","link":21}
      ],
      "outputs": [{"name":"IMAGE","type":"IMAGE"}] // frames batch
    },

    // ---- Dynamic mouth mask (frame diff based) ----
    {
      "id": 40,
      "type": "BatchFrameDifference",
      "pos": [1420, 600],
      "size": [260, 120],
      "inputs": [{"name":"images","type":"IMAGE","link":30}],
      "outputs": [{"name":"IMAGE","type":"IMAGE"}]
    },
    {
      "id": 41,
      "type": "ImageNormalize",
      "pos": [1700, 600],
      "size": [220, 70],
      "inputs": [{"name":"image","type":"IMAGE","link":40}],
      "outputs": [{"name":"IMAGE","type":"IMAGE"}]
    },
    {
      "id": 42,
      "type": "ImageThreshold",
      "pos": [1950, 600],
      "size": [220, 70],
      "widgets_values": [0.06],
      "inputs": [{"name":"image","type":"IMAGE","link":41}],
      "outputs": [{"name":"MASK","type":"MASK"}]
    },
    {
      "id": 43,
      "type": "MaskMorphology",
      "pos": [2200, 600],
      "size": [240, 90],
      "widgets_values": ["close", 2],
      "inputs": [{"name":"mask","type":"MASK","link":42}],
      "outputs": [{"name":"MASK","type":"MASK"}]
    },
    {
      "id": 44,
      "type": "MaskBlur",
      "pos": [2460, 600],
      "size": [220, 70],
      "widgets_values": [4],
      "inputs": [{"name":"mask","type":"MASK","link":43}],
      "outputs": [{"name":"MASK","type":"MASK"}]
    },
    {
      "id": 45,
      "type": "MaskTemporalMedian",
      "pos": [2710, 600],
      "size": [260, 80],
      "widgets_values": [5],
      "inputs": [{"name":"mask","type":"MASK","link":44}],
      "outputs": [{"name":"MASK","type":"MASK"}]
    },

    // ---- Composite only where the mouth moves ----
    {
      "id": 50,
      "type": "ImageCompositeMasked",
      "pos": [1420, 820],
      "size": [360, 120],
      "title": "Composite (use dynamic mouth mask)",
      "inputs": [
        {"name":"background","type":"IMAGE","link":7},
        {"name":"foreground","type":"IMAGE","link":30},
        {"name":"mask","type":"MASK","link":45}
      ],
      "outputs": [{"name":"IMAGE","type":"IMAGE"}]
    },

    // ---- Frames -> Video, then mux audio ----
    {
      "id": 60,
      "type": "VHS_BatchToVideo",
      "pos": [1840, 820],
      "size": [300, 120],
      "widgets_values": [25, "libx264", "medium", 18],
      "inputs": [{"name":"images","type":"IMAGE","link":50}],
      "outputs": [{"name":"VIDEO","type":"VIDEO"}]
    },
    {
      "id": 61,
      "type": "VHS_MuxAudio",
      "pos": [2160, 820],
      "size": [280, 110],
      "inputs": [
        {"name":"video","type":"VIDEO","link":60},
        {"name":"audio","type":"AUDIO","link":21}
      ],
      "outputs": [{"name":"VIDEO","type":"VIDEO"}]
    },

    // ---- Saves ----
    {
      "id": 70,
      "type": "SaveImage",
      "pos": [1040, 360],
      "size": [240, 70],
      "widgets_values": ["t2i_portrait"],
      "inputs": [{"name":"images","type":"IMAGE","link":7}]
    },
    {
      "id": 71,
      "type": "VHS_SaveVideo",
      "pos": [2460, 820],
      "size": [300, 100],
      "widgets_values": ["talking_portrait", "mp4"],
      "inputs": [{"name":"video","type":"VIDEO","link":61}]
    }
  ],
  "links": [
    [1, 1, 1, 2, 0, "CLIP"],
    [1, 1, 1, 3, 0, "CLIP"],
    [1, 1, 0, 5, 0, "MODEL"],
    [2, 2, 0, 5, 1, "CONDITIONING"],
    [3, 3, 0, 5, 2, "CONDITIONING"],
    [4, 4, 0, 5, 3, "LATENT"],
    [5, 5, 0, 6, 0, "LATENT"],
    [1, 1, 2, 6, 1, "VAE"],
    [6, 6, 0, 7, 0, "IMAGE"],

    [7, 7, 0, 30, 0, "IMAGE"],
    [20, 20, 0, 21, 0, "AUDIO"],
    [21, 21, 0, 30, 1, "AUDIO"],

    [30, 30, 0, 40, 0, "IMAGE"],
    [40, 40, 0, 41, 0, "IMAGE"],
    [41, 41, 0, 42, 0, "IMAGE"],
    [42, 42, 0, 43, 0, "MASK"],
    [43, 43, 0, 44, 0, "MASK"],
    [44, 44, 0, 45, 0, "MASK"],

    [7, 7, 0, 50, 0, "IMAGE"],
    [30, 30, 0, 50, 1, "IMAGE"],
    [45, 45, 0, 50, 2, "MASK"],

    [50, 50, 0, 60, 0, "IMAGE"],
    [60, 60, 0, 61, 0, "VIDEO"],
    [21, 21, 0, 61, 1, "AUDIO"],

    [7, 7, 0, 70, 0, "IMAGE"],
    [61, 61, 0, 71, 0, "VIDEO"]
  ],
  "extra": {
    "ds": { "scale": 0.85, "offset": [0, 0] }
  },
  "version": 0.4
}
