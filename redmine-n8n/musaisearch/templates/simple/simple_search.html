<form id="search" method="{{ method or 'POST' }}" action="{{ url_for('search') }}" role="search">
  <div id="search_header">
    <div id="search_view">
      <div class="search_box">
        <input id="q" name="q" type="text" placeholder="{{ _('Search for...') }}" autocomplete="off" autocapitalize="none" spellcheck="false" autocorrect="off" dir="auto" value="{{ q or '' }}">
        <button id="clear_search" type="button" class="hide_if_nojs" aria-label="{{ _('Clear search') }}">âœ•</button>
        <button id="send_search" type="submit" aria-label="{{ _('search') }}"><span class="hide_if_nojs">{{ icon_big('search') }}</span><span class="show_if_nojs">{{ _('search') }}</span></button>
        <div class="autocomplete hide_if_nojs"><ul></ul></div>
      </div>
    </div>
  </div>
  {% for category in selected_categories %}
  <input type="hidden" name="category_{{ category }}" value="1" >
  {% endfor %}
  <input type="hidden" name="language" value="{{ current_language }}" >
  <input type="hidden" name="time_range" value="{{ time_range }}" >
  <input type="hidden" name="safesearch" value="{{ safesearch }}" >
  {% if timeout_limit %}<input type="hidden" name="timeout_limit" value="{{ timeout_limit|e }}" >{% endif %}
</form>
<script>
  (function wireHomeClearButton()
  {
    try
    {
      var q = document.getElementById('q');
      var clear = document.getElementById('clear_search');
      if (!q || !clear) { return; }

      var sync = function()
      {
        try { clear.classList.toggle('empty', (q.value || '').length === 0); }
        catch (_) { /* no-op */ }
      };

      sync();
      clear.addEventListener('click', function(e)
      {
        e.preventDefault();
        try { q.value = ''; q.focus(); } catch (_) { /* no-op */ }
        sync();
      });
      q.addEventListener('input', sync, { passive: true });
    }
    catch (_) { /* no-op */ }
  })();
</script>
