{% from 'simple/icons.html' import icon_big %}
{%- set category_icons = {
    'apps': 'appstore',
    'dictionaries': 'book',
    'files': 'file-tray-full',
    'general': 'search',
    'images': 'image',
    'it': 'layers',
    'map': 'location',
    'music': 'musical-notes',
    'news': 'newspaper',
    'radio': 'radio',
    'science': 'school',
    'social media': 'people',
    'TV': 'tv',
    'videos': 'play',
}  -%}
<div id="categories" class="search_categories">{{- '' -}}
    <div id="categories_container">
        {%- if not search_on_category_select or not display_tooltip -%}
            {%- for category in categories -%}
                <div class="category category_checkbox">{{- '' -}}
                    <input type="checkbox" id="checkbox_{{ category|replace(' ', '_') }}" name="category_{{ category }}"{% if category in selected_categories %} checked="checked"{% endif %}>
                    <label for="checkbox_{{ category|replace(' ', '_') }}" class="tooltips">
                        {{- icon_big(category_icons[category]) if category in category_icons  else icon_big('globe') -}}
                        <div class="category_name">{{- _(category) -}}</div>
                    </label>
                </div>
            {%- endfor -%}
            {%- if display_tooltip %}<div class="help">{{ _('Click on the magnifier to perform search') }}</div>{% endif -%}
        {%- else -%}
            {%- for category in categories -%}{{- '\n' -}}
                <button type="submit" name="category_{{ category }}" class="category category_button {% if category in selected_categories %}selected{% endif %}">
                    {{- icon_big(category_icons[category]) if category in category_icons else icon_big('globe') -}}
                    <div class="category_name">{{- _(category) -}}</div>{{- '' -}}
                </button>{{- '' -}}
            {%- endfor -%}
            <input name="categories" id="selected-categories" type="hidden" />
            {{- '\n' -}}
        {%- endif -%}
    </div>{{- '' -}}
</div>
<div id="categories_mobile" class="hide_if_nojs">{{- '' -}}
  <select id="categories_select" aria-label="{{ _('Search type') }}">{{- '' -}}
    <option value="">{{ _('Choose type') }}</option>
    {%- for category in categories -%}
      <option value="{{ category }}"{% if category in selected_categories %} selected{% endif %}>{{ _(category) }}</option>
    {%- endfor -%}
  </select>{{- '' -}}
</div>
<script>
(function initMobileCategorySelect()
{
  try
  {
    var selectEl = document.getElementById('categories_select');
    var formEl = document.getElementById('search');
    if (!selectEl || !formEl) { return; }

    selectEl.addEventListener('change', function ()
    {
      // Remove any prior category inputs (checkbox or hidden) so only one category is submitted
      var allCategoryInputs = formEl.querySelectorAll('input[name^="category_"]');
      for (var i = 0; i < allCategoryInputs.length; i++)
      {
        var inp = allCategoryInputs[i];
        if (inp.type === 'checkbox') { inp.checked = false; }
        if (inp.type === 'hidden') { inp.parentNode && inp.parentNode.removeChild(inp); }
      }

      var category = selectEl.value;
      if (!category) { return; }

      // Create a hidden input as if a category button/checkbox was selected
      var hidden = document.createElement('input');
      hidden.type = 'hidden';
      hidden.name = 'category_' + category;
      hidden.value = '1';
      formEl.appendChild(hidden);

      if (typeof formEl.requestSubmit === 'function')
      {
        formEl.requestSubmit();
      }
      else
      {
        formEl.submit();
      }
    });
  }
  catch (e) { /* no-op */ }
})();
</script>
